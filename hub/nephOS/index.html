<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>nephOS • Nota Ephemera</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
 --bg:#222222;
 --card:#2b2b2b;
 --shadow-dark:#1a1a1a;
 --shadow-light:#3a3a3a;
 --text:#f5f5f5;
 --accent:#38bdf8;
}
[data-theme="light"]{
 --bg:#ECECEC;
 --card:#ECECEC;
 --shadow-dark:#cfcfcf;
 --shadow-light:#ffffff;
 --text:#111111;
 --accent:#2563eb;
}
*{box-sizing:border-box;-webkit-user-select:none;user-select:none}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui;min-height:100vh}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;font-weight:600}
.toggle{cursor:pointer;padding:8px 14px;border-radius:12px;background:var(--card);box-shadow:6px 6px 12px var(--shadow-dark),-6px -6px 12px var(--shadow-light)}
main{max-width:760px;margin:auto;padding:16px}
.card{border-radius:18px;padding:20px;margin-bottom:20px;background:var(--card);box-shadow:8px 8px 16px var(--shadow-dark),-8px -8px 16px var(--shadow-light);position:relative}
.blur{filter:blur(12px)}
.watermark{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:42px;font-weight:700;opacity:0.04;pointer-events:none;transform:rotate(-20deg)}
.sensitive{text-align:center;font-size:12px;opacity:.7;margin-bottom:10px}
input,textarea,select,button{width:100%;border:none;outline:none;margin-top:12px;padding:14px;border-radius:14px;background:var(--card);color:var(--text);box-shadow:inset 6px 6px 12px var(--shadow-dark),inset -6px -6px 12px var(--shadow-light)}
button{cursor:pointer;color:var(--accent);font-weight:600}
pre{white-space:pre-wrap}
.hidden{display:none}
footer{text-align:center;font-size:12px;opacity:.6;padding:20px}
</style>
      <meta name="theme-color" content="#ECECEC">
        <div style="background-color:#ECECEC;
          border-bottom-left-radius:15px; 
          border-bottom-right-radius:15px;">
    <figure aligncenter size-full is-resized is-style-default>
        <a href="https://gustavosaez.com.br/hub/geradordesenhas">
    <center>
      <img src="https://gustavosaez.com.br/hub/geradordesenhas/favicon.png" height="68">
    </center>
        </a>
    </figure>
  </div>
</head>
<body>
<header>
<span>nephOS</span>
<div class="toggle" onclick="toggleTheme()">Light / Dark</div>
</header>
<main>
<div class="card" id="gen">
<h3>Criar nota</h3>
<textarea id="msg" rows="4"></textarea>
<select id="ttl"><option value="15">15s</option><option value="30" selected>30s</option><option value="60">60s</option></select>
<input id="pwd" type="password" placeholder="Senha">
<button onclick="generate()">Gerar link</button>
<textarea id="link" rows="2"></textarea>
<button onclick="copyLink()">Copiar link</button>
</div>
<div class="card hidden" id="view">
<div class="watermark">nephOS • CONFIDENCIAL</div>
<div class="sensitive">⚠️ Conteúdo sensível — não compartilhe, não capture.</div>
<input id="pwdView" type="password" placeholder="Digite a senha">
<pre id="content"></pre>
<small id="timer"></small>
</div>
</main>
<footer>nephOS • Privacidade por padrão • © Gustavo Sáez</footer>
<script>
const root=document.documentElement;
const saved=localStorage.getItem("theme");
if(saved)root.dataset.theme=saved;
function toggleTheme(){const t=root.dataset.theme==="light"?"dark":"light";root.dataset.theme=t;localStorage.setItem("theme",t);}
document.addEventListener("contextmenu",e=>e.preventDefault());
const params=new URLSearchParams(location.search);
const m=params.get("m");
const tts=parseInt(params.get("t")||30);
const gen=document.getElementById("gen");
const view=document.getElementById("view");
const content=document.getElementById("content");
const timer=document.getElementById("timer");
async function generate(){
 const enc=new TextEncoder();
 const key=await crypto.subtle.importKey("raw",enc.encode(pwd.value),"PBKDF2",false,["deriveKey"]);
 const aes=await crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array(8),iterations:100000,hash:"SHA-256"},key,{name:"AES-GCM",length:256},false,["encrypt"]);
 const iv=crypto.getRandomValues(new Uint8Array(12));
 const encrypted=await crypto.subtle.encrypt({name:"AES-GCM",iv},aes,enc.encode(msg.value));
 const full=new Uint8Array([...iv,...new Uint8Array(encrypted)]);
 let b64=btoa(String.fromCharCode(...full)).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
 link.value=location.origin+location.pathname+"?m="+b64+"&t="+ttl.value;
}
async function decode(){
 try{
 let s=m.replace(/-/g,'+').replace(/_/g,'/');while(s.length%4)s+='=';
 const data=Uint8Array.from(atob(s),c=>c.charCodeAt(0));
 const key=await crypto.subtle.importKey("raw",new TextEncoder().encode(pwdView.value),"PBKDF2",false,["deriveKey"]);
 const aes=await crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array(8),iterations:100000,hash:"SHA-256"},key,{name:"AES-GCM",length:256},false,["decrypt"]);
 const dec=await crypto.subtle.decrypt({name:"AES-GCM",iv:data.slice(0,12)},aes,data.slice(12));
 content.textContent=new TextDecoder().decode(dec);
 history.replaceState({},'',location.pathname);
 gen.classList.add("hidden");view.classList.remove("hidden");
 let r=tts;timer.textContent=`Autodestruição em ${r}s`;
 const i=setInterval(()=>{r--;timer.textContent=`Autodestruição em ${r}s`;if(r<=0){clearInterval(i);wipe();}},1000);
 }catch{content.textContent="Senha incorreta";}
}
function wipe(){content.textContent="Mensagem destruída";}
function copyLink(){navigator.clipboard.writeText(link.value);}
window.addEventListener("blur",()=>{view.classList.add("blur")});
window.addEventListener("focus",()=>{view.classList.remove("blur")});
if(m){gen.classList.add("hidden");view.classList.remove("hidden");pwdView.addEventListener("change",decode);}
</script>
</body>
</html>
